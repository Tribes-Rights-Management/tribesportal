# Authority Export & Retention Rules v1.0

> **Status**: LOCKED  
> **Scope**: All authority event exports and data retention  
> **Last Updated**: 2026-01-17

---

## Objective

Allow defensible exports without creating data leakage or shadow records.

---

## A. Export Authorization

### Who Can Export

| Role | Export Authority |
|------|-----------------|
| Platform Executive | ✓ Full |
| Delegated Compliance (future) | ✓ Limited |
| Organization Admin | ✗ None |
| Standard Member | ✗ None |
| External Auditor | ✗ None (download only, not generate) |

---

## B. Exportable Content

### What Can Be Exported

| Data | Included |
|------|----------|
| Authority event history | ✓ |
| Approval decisions | ✓ |
| Timestamps | ✓ |
| Actors (name, email) | ✓ |
| Scopes (platform/org) | ✓ |
| Human-readable summaries | ✓ |
| Target users | ✓ |
| Reasons (if provided) | ✓ |

### What Cannot Be Exported

| Data | Excluded |
|------|----------|
| Internal permission IDs | ✗ |
| System notes | ✗ |
| Non-authority user metadata | ✗ |
| Database keys | ✗ |
| Implementation details | ✗ |

---

## C. Export Format

### Primary Format: PDF

- Professional, print-ready layout
- Watermarked header on each page
- Table of contents for large exports
- Digital signature metadata

### Secondary Format: CSV (Optional)

- For data analysis
- Clearly labeled columns
- Human-readable values (not IDs)

### Required Labeling

Every export must include:

```
TRIBES AUTHORITY HISTORY EXPORT
Generated on: [ISO 8601 timestamp]
Generated by: [User name and email]
Scope: [Platform / Organization name]
Reference ID: [Unique export identifier]

This document is a read-only snapshot of authority events 
as of the generation date. It does not reflect subsequent changes.
```

### Integrity Reference

Each export includes:

| Field | Purpose |
|-------|---------|
| Reference ID | Unique identifier for this export |
| Export timestamp | When generated |
| Record count | Number of events included |
| Date range | Events from/to |
| Hash | SHA-256 of content for integrity verification |

---

## D. Export Logging (Mandatory)

Every export generates an **immutable audit event**:

```typescript
interface ExportAuditEvent {
  event_type: 'authority_history_exported';
  actor_id: string;
  actor_email: string;
  timestamp: string;
  
  export_details: {
    reference_id: string;
    scope: 'platform' | 'organization';
    organization_id?: string;
    date_range_start: string;
    date_range_end: string;
    record_count: number;
    format: 'pdf' | 'csv';
  };
  
  reason?: string; // Optional justification
}
```

### Export Audit Display

```
Jan 16, 2026 • 3:45 PM UTC

Sarah Lee exported authority history
Scope: Tribes Licensing
Records: 47 events (Jan 1 – Jan 15, 2026)
Format: PDF
Reference: EXP-20260116-154532-8A7B3C
```

---

## E. Retention Policy

### Authority Events

| Retention | Duration |
|-----------|----------|
| Standard | **Indefinite** (never deleted) |
| Format | Append-only |
| Legal hold | Supported |

### Generated Exports

| Retention | Duration |
|-----------|----------|
| Default | 90 days |
| Configurable | Yes (organization setting, future) |
| Regeneration | Allowed, but logged as new export |

### Export Cleanup

- Expired exports are marked `status: 'expired'`
- Metadata retained for audit trail
- File content purged
- Regeneration creates new export with new reference ID

---

## F. Corrections & Errors

### Core Rule

> **No edits. No redactions. Corrections are new events.**

### Correction Protocol

If an export contains incorrect data:

1. ❌ Do NOT modify the original export
2. ✓ Generate a corrected export
3. ✓ Log correction reason
4. ✓ Reference original export ID

### Correction Audit Entry

```
Jan 17, 2026 • 10:00 AM UTC

Sarah Lee generated corrected authority history export
Corrects: EXP-20260116-154532-8A7B3C
Reason: "Original export included draft events in error"
New Reference: EXP-20260117-100000-9B8C4D
```

---

## G. Export UI Copy

### Export Button

```
Export authority history
```

### Export Dialog Title

```
Generate Authority History Export
```

### Export Dialog Description

```
This will generate an official export of authority events. 
The export will be logged and attributed to you.
```

### Scope Selection Label

```
Export scope
```

### Date Range Label

```
Date range
```

### Reason Field Label

```
Reason for export (optional)
```

### Generate CTA

```
Generate export
```

### Post-Export Confirmation

```
Export generated.
Reference: [EXP-ID]
This action has been recorded in the audit log.
```

---

## H. Export File Naming

### Convention

```
tribes-authority-history-[SCOPE]-[YYYYMMDD]-[HHMMSS].pdf
```

### Examples

```
tribes-authority-history-platform-20260116-154532.pdf
tribes-authority-history-tribes-licensing-20260116-154532.pdf
```

---

## I. RLS for Export Records

### Platform Executive: Full Access

```sql
CREATE POLICY "platform_exec_manage_exports"
ON authority_exports
FOR ALL
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM user_profiles
    WHERE user_profiles.user_id = auth.uid()
    AND user_profiles.platform_role = 'platform_admin'
  )
);
```

### External Auditor: Download Only

```sql
CREATE POLICY "auditor_download_exports"
ON authority_exports
FOR SELECT
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM user_profiles
    WHERE user_profiles.user_id = auth.uid()
    AND user_profiles.platform_role = 'external_auditor'
  )
  AND status = 'completed'
);
```

---

## J. Lock-In Summary

| Principle | Rule |
|-----------|------|
| History visibility | Strictly role-scoped |
| History mutability | Immutable, append-only |
| Exports | Rare, logged, labeled |
| Retention | Truth over convenience |
| Modifications | Never silent |

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01-17 | Initial export and retention rules |
